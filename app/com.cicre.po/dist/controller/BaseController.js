sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/routing/History","sap/ui/core/UIComponent","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment"],function(e,t,o,i,a,r,l){"use strict";return e.extend("com.cicre.po.controller.BaseController",{oldmodelvalue:"",WBSCode:"",WBSCodeGroup:"",getRouter:function(){return sap.ui.core.UIComponent.getRouterFor(this)},onNavBack:function(e){var o,i;o=t.getInstance();i=o.getPreviousHash();if(i!==undefined){window.history.go(-1)}else{this.getRouter().navTo("RouteWorkList",{},true)}},getModel:function(e){return this.getView().getModel(e)},setModel:function(e,t){return this.getView().setModel(e,t)},getResourceBundle:function(){return this.getOwnerComponent().getModel("i18n").getResourceBundle()},IndexMonth:function(){this.currentYear=(new Date).getFullYear();this.afterfivecurrentYear=(new Date).getFullYear()-5;this.years=[];for(var e=this.afterfivecurrentYear;e<=this.currentYear;e++){for(var t=1;t<=12;t++){this.years.push({id:t+"-"+this.afterfivecurrentYear,text:t+"-"+this.afterfivecurrentYear,issort:this.afterfivecurrentYear})}++this.afterfivecurrentYear}this.years=this.years.sort((e,t)=>t.issort-e.issort)},onShareEmailPress:function(){var e=this.getModel("objectView")||this.getModel("worklistView");sap.m.URLHelper.triggerEmail(null,e.getProperty("/shareSendEmailSubject"),e.getProperty("/shareSendEmailMessage"))},onchangeCurrency:function(){this.getView().getModel("localJson").setProperty("/Currency",this.getView().byId("idCurrency").getValue());if(this.getView().byId("idCurrency").getValue()==="USD"){this.CustomCurrency=2}else{this.CustomCurrency=2}},onChangeAmount:function(e){var t=this.getView().byId("idEstimatedServicesTable").getModel("localJson");var o=e.getSource().getParent().getBindingContext("localJson").getPath().split("/");var i=parseInt(o[2]);var a=t.getProperty("/EstimatedContracts/"+i);a.Amount=parseFloat(a.Amount).toFixed(this.CustomCurrency);t.setProperty("/EstimatedContracts/"+i,a);t.refresh(true);this.ContractValueHeader()},onDisplaySearchProjDialogFailre:function(){if(!this._oProjDialogF){this._oProjDialogF=sap.ui.xmlfragment("com.cicre.po.view.fragments.ProjSearchDialog",this);this._oProjDialogF.setModel(this.getView().getModel())}this._oProjDialogF.open();var e=new sap.m.StandardListItem({title:"{IdText}",description:"{IdNumber}"});var t=[];var o=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"Zone");var i=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,this.sCoCode);var a=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.EQ,this.sProjectCode);t.push(o);t.push(i);t.push(a);this._oProjDialogF.bindAggregation("items",{path:"/ValueHelpSet",template:e,filters:t})},handleSearchProj:function(e){var t=e.getParameter("value");var o=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"Zone");var i=new sap.ui.model.Filter("SelectionParameter",sap.ui.model.FilterOperator.Contains,t);var a=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.Contains,this.sCoCode);var r=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var l=new sap.m.StandardListItem({title:"{IdText}",description:"{IdNumber}"});var s=[];s.push(o);s.push(i);s.push(a);s.push(r);this._oProjDialogF.bindAggregation("items",{path:"/ValueHelpSet",template:l,filters:s})},onSelectProjList:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){t.sProjj=e.getObject().IdNumber;sap.ui.getCore().byId("idSearchByProjectt").setValue(e.getObject().IdText)})}else{sap.m.MessageToast.show("No new item was selected.")}e.getSource().getBinding("items").filter([])},onListDeletePress:function(e){var t=false;var o;if(e.getSource){o=e.getSource();t=true}else{o=this.byId(e)}var i=o.getParent().getParent();if(o.getIcon()=="sap-icon://delete"&&t){o.setIcon("sap-icon://decline");o.setTooltip(this.getResourceBundle().getText("attachmentCancel"));i.setMode("Delete")}else{o.setIcon("sap-icon://delete");o.setTooltip(this.getResourceBundle().getText("attachmentDelete"));i.setMode("None")}},BuildD:function(e){var t=this;var o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/selectedBuilding")));var i=JSON.parse(JSON.stringify(o));var a=JSON.parse(JSON.stringify(t.myBuildingSet));var r=0;var l=0;var s=[];var n=[];var d=sap.ui.getCore().byId("IdBuildingTable").getModel("localJson").oData.BuildingSet;$.each(i,function(e,i){$.each(a,function(a,s){if(i.Model===s.Model&&i.Group===s.Group){r=r+1;l=l+1;if(l>=2){$.each(d,function(e,t){if(i.Model===t.Model&&i.Group===t.Group){sap.ui.getCore().byId("IdBuildingTable").getItems()[e].setSelected(false);sap.m.MessageToast.show("Model and  Boq is already added!");l=0}});t.myBuildingSet.splice(a,1);o.splice(e,1);t.getView().getModel("localJson").setProperty("/selectedBuilding",o)}}});r=0});if(r>1){$.each(d,function(t,o){if(e.Model===o.Model&&e.Group===o.Group){sap.ui.getCore().byId("IdBuildingTable").getItems()[t].setSelected(false);sap.m.MessageToast.show("Model and  Boq is already added!")}})}},onDisplaySearchContractRefrence:function(){if(!this._ContractDescDialog){this._ContractDescDialog=sap.ui.xmlfragment("com.cicre.po.view.fragments.ContractDescriptionDialog",this);this._ContractDescDialog.setModel(this.getView().getModel())}this._ContractDescDialog.open();var e=new sap.m.StandardListItem({title:"{IdText}",description:"{IdNumber}"});var t=[];var o=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"ContDesc2");t.push(o);this._ContractDescDialog.bindAggregation("items",{path:"/ValueHelpSet",template:e,filters:t})},handleSearchContract:function(e){var t=e.getParameter("value");var o=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"ContDesc");var i=new sap.ui.model.Filter("SelectionParameter",sap.ui.model.FilterOperator.Contains,t);var a=new sap.m.StandardListItem({title:"{IdText}",description:"{IdNumber}"});var r=[];r.push(o);r.push(i);this._ContractDescDialog.bindAggregation("items",{path:"/ValueHelpSet",template:a,filters:r})},onSelectContractList:function(e){var t=this,o=e.getParameters().id;var i=e.getParameter("selectedContexts");if(i&&i.length){i.map(function(e){t.ContractCode=e.getObject().IdNumber;t.getView().byId("idSearchByContract").setValue(e.getObject().IdText)})}else{t.ContractCode="";t.getView().byId("idSearchByContract").setValue("");sap.m.MessageToast.show("No new item was selected.")}e.getSource().getBinding("items").filter([])},ch_SearchByContract:function(){this.ContractCode="";this.getView().byId("idSearchByContract").setValue("")},ch_SearchByVendor:function(){this.sSearchVendor="";this.getView().byId("idSearchByVendor").setValue("")},onContractValueHelpPressc:function(e){var t=this,o=t.getOwnerComponent().getModel(),i=t.getView().getModel("localJson"),a=[];this.getView().getModel("localJson").setProperty("/ContractPOHeaderSet",[]);var r=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.RefrenceContractTable",this);if(!this._oContractValueHelpDialog){this._oContractValueHelpDialog=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.RefrenceContractValueHelpFilterBar",this);this._oContractValueHelpDialog.setTable(r);this.getView().addDependent(this._oContractValueHelpDialog)}this._oContractValueHelpDialog.open()},onContractValueHelpPress:function(e){var t=this.getModel("refreneContractColumnsModel"),o=t.getData().cols,i=e.getSource().getId();if(e.getSource().getBindingContext("localJson")){var a=e.getSource().getBindingContext("localJson").getPath()}var r=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.RefrenceContractTable",this);r.setModel(this.getModel("localJson"));r.setModel(t,"columns");if(r.bindRows){r.bindAggregation("rows","/ContractPOHeaderSet")}if(r.bindItems){r.bindAggregation("items","/ContractPOHeaderSet",function(){return new sap.m.ColumnListItem({cells:o.map(function(e){return new sap.m.Label({text:"{"+e.template+"}"})})})})}if(!this._oContractValueHelpDialog){this._oContractValueHelpDialog=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.RefrenceContractValueHelpFilterBar",this);this._oContractValueHelpDialog.setTable(r);if(i.lastIndexOf("idRefrenceContrac")>-1){r.setSelectionMode("MultiToggle");this.selectedContractPath=""}else if(i.lastIndexOf("idCreateContract")>-1){this.selectedContractPath="/ContractPOHeaderSet";r.setSelectionMode("Single")}else{this.selectedContractPath=a;r.setSelectionMode("Single")}this.getView().addDependent(this._oContractValueHelpDialog)}this.getModel("localJson").setProperty("/ContractPOHeaderSet",[]);this.getModel("localJson").refresh();this._oContractValueHelpDialog.open()},onContractFilterBarSearch:function(){},onboqValueHelpPress:function(){if(!this._BoqDialog){this._BoqDialog=sap.ui.xmlfragment("com.cicre.po.view.fragments.selectBoqDialog",this);this._BoqDialog.setModel(this.getView().getModel())}this._BoqDialog.open();var e=new sap.ui.model.Filter("Boq",sap.ui.model.FilterOperator.EQ,this.oldmodelvalue);var t=new sap.ui.model.Filter("CompCode",sap.ui.model.FilterOperator.EQ,this.sCoCode);var o=new sap.ui.model.Filter("Project",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var i=new sap.m.StandardListItem({title:"{BoqSub}",description:"{BoqDesc}"});var a=[];a.push(e);a.push(t);a.push(o);this._BoqDialog.bindAggregation("items",{path:"/BoqSubItemSet",template:i,filters:a})},handleSearchBoq:function(e){if(!this._BoqDialog){this._BoqDialog=sap.ui.xmlfragment("com.cicre.po.view.fragments.selectBoqDialog",this);this._BoqDialog.setModel(this.getView().getModel())}this._BoqDialog.open();var t=new sap.ui.model.Filter("Boq",sap.ui.model.FilterOperator.EQ,this.oldmodelvalue);var o=new sap.ui.model.Filter("CompCode",sap.ui.model.FilterOperator.EQ,this.sCoCode);var i=new sap.ui.model.Filter("Project",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var a=new sap.m.StandardListItem({title:"{BoqSub}",description:"{BoqDesc}"});var r=[];r.push(t);r.push(o);r.push(i);this._BoqDialog.bindAggregation("items",{path:"/BoqSubItemSet",template:a,filters:r})},onSelectBoqList:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){t.BoqAll=e.getObject().BoqSub;t.BoqDescAll=e.getObject().BoqDesc;t.getView().byId("idhandboq").setValue(e.getObject().BoqDesc);t.onlistofPress()})}else{t.BoqAll="";t.getView().byId("idhandboq").setValue("");sap.m.MessageToast.show("No new item was selected.")}e.getSource().getBinding("items").filter([])},onlistofPress:function(){var e=this,t=this.getView().getModel("localJson"),o=t.getProperty("/BuildingSet");$.each(o,function(t,o){o.BoqDesc=e.BoqDescAll;o.Group=e.BoqAll});t.setProperty("/BuildingSet",o)},onContractValueHelpOkPress:function(){var e=this,t=this.getModel("localJson"),o=this.getModel("localJson"),i=this._oContractValueHelpDialog.getTable().getSelectedIndices(),a=[],r=[];for(var l=0;l<i.length;l++){var s=this._oContractValueHelpDialog.getTable().getContextByIndex(i[l]).getObject();a.push(s);r.push(s.PurchDoc)}if(this.selectedContractPath===""){t.setProperty("/Contracts",a);e.selectedRefContracts=r;var n=e.selectedRefContracts.join();e.getView().byId("idRefrenceContract").setValue(n);t.refresh()}else if(this.selectedContractPath==="/ContractNo"){if(a.length!=0){o.setProperty(this.selectedContractPath,a[0].PurchDoc);o.refresh();this.byId("idCreateContract").fireChange()}}else{if(a.length!=0){o.setProperty(this.selectedContractPath+"/ContractReference",a[0].PurchDoc);o.refresh()}}this.onContractValueHelpCancelPress()},onContractValueHelpCancelPress:function(){this._oContractValueHelpDialog.close();this._oContractValueHelpDialog.destroy();this._oContractValueHelpDialog=null;this.ContractCode="";this.sSearchVendor=""},onContractFilterBarSearch:function(){var e=this,t=e.getModel("localJson"),o=e.getOwnerComponent().getModel();var i=e.getView().byId("RefrenceContractTable");var a=new sap.ui.model.Filter("PoNumber",sap.ui.model.FilterOperator.EQ,this.ContractCode);var r=new sap.ui.model.Filter("Vendor",sap.ui.model.FilterOperator.EQ,this.sSearchVendor);var l=new sap.ui.model.Filter("CompCode",sap.ui.model.FilterOperator.EQ,this.sCoCode);var s=new sap.ui.model.Filter("PurchOrg",sap.ui.model.FilterOperator.EQ,this.sPOrg);var n=new sap.ui.model.Filter("PurGroup",sap.ui.model.FilterOperator.EQ,this.sPGrp);var d=new sap.ui.model.Filter("Flag",sap.ui.model.FilterOperator.EQ,"X");var u=new sap.ui.model.Filter("TempStatus",sap.ui.model.FilterOperator.EQ,"R");var g=[];if(this.ContractCode.length>0){g.push(a)}if(this.sSearchVendor.length>0&&this.getView().byId("idSearchByVendor").getValue()!==""){g.push(r)}if(this.sCoCode.length>0){g.push(l)}if(this.sPOrg.length>0){g.push(s)}if(this.sPGrp.length>0){g.push(n)}g.push(d);g.push(u);o.read("/ContractPOHeaderSet",{filters:g,async:false,method:"GET",success:function(e){t.setProperty("/ContractPOHeaderSet",e.results);t.refresh()},error:function(){}});t.refresh()},_oMessagePopover:null,onPressMessagePopover:function(e){if(!this._oMessagePopover){this._oMessagePopover=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.MessagePopover",this);this.getView().addDependent(this._oMessagePopover)}this._oMessagePopover.toggle(e.getSource())},async onWBSSelectionValueHelpPress(e){this.WBSCode="";this.WBSCodeGroup="";var t=this,o=t.getOwnerComponent().getModel(),i=t.getView().getModel("localJson"),a=[];i.setProperty("/WBSSet",[]);var r=this.getView();var s="com.cicre.po.view.fragments.SelectMultiWBSDialogTable";l.load({id:r.getId(),name:s,controller:this}).then(function(e){return l.load({id:r.getId(),name:"com.cicre.po.view.fragments.SelectMultiWBSDialoge",controller:t}).then(function(o){t._contractDialog=o;t._contractDialog.setTable(e);r.addDependent(t._contractDialog);return t._contractDialog})}).then(function(e){e.open()}).catch(function(e){sap.m.MessageBox.error("Error loading WBS dialog: "+e.message)});this.getView().getModel("localJson").setProperty("/selectGroupBoq",false);t.aContexts=[];t.Boqs=[];t.BUBoQs=[];t.WBSBoQs=[];this.getView().getModel("localJson").setProperty("/selectGroupBoq",false);t.aContexts=[];t.Boqs=[];t.BUBoQs=[];t.WBSBoQs=[]},handleSearchWBSPress:function(){var e=this,t=e.getOwnerComponent().getModel(),o=e.getView().getModel("localJson"),i=[];this.getView().getModel("localJson").setProperty("/WBSSet",[]);var a=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"WBS");var r=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,this.sCoCode);var l=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var s=new sap.ui.model.Filter("SelectionParameter4",sap.ui.model.FilterOperator.EQ,this.WBSCode);var n=new sap.ui.model.Filter("SelectionParameter7",sap.ui.model.FilterOperator.EQ,this.WBSCodeGroup);i.push(a);i.push(r);if(this.sProjectCode!=""){i.push(l)}if(this.WBSCode.length>0){i.push(s)}if(this.WBSCodeGroup.length>0){i.push(n)}var d="/ValueHelpSet";var u=t.bindList(d,undefined,undefined,i);u.requestContexts(0,100).then(function(t){var o=t.map(e=>e.getObject());o.forEach(e=>{e.Group="";e.Model=e.IdNumber});e.getView().getModel("localJson").setProperty("/WBSSet",o);if(e.WBSCodeGroup.length>0){e.getView().getModel("localJson").setProperty("/selectGroupBoq",true)}e.getView().getModel("localJson").refresh(true)}).catch(function(e){sap.m.MessageToast.show("Error fetching data");console.error(e)});e.aContexts=[];e.Boqs=[];e.BUBoQs=[];e.WBSBoQs=[]},onVHContractOk:function(){var e=this,t=this.getModel("localJson"),o=this.getModel("localJson"),i=this._contractDialog.getTable().getSelectedIndices(),a=[],r=[];for(var l=0;l<i.length;l++){var s=this._contractDialog.getTable().getContextByIndex(i[l]).getObject();a.push(s)}t.setProperty("/Contracts",a);t.refresh();this.onWBSContractClose()},onWBSContractClose:function(e){this._contractDialog.close();this._contractDialog.destroy();this._contractDialog=null},onBuildingSelectionValueHelpPressc:function(e){var t=this,o=t.getOwnerComponent().getModel(),i=t.getView().getModel("localJson"),a=[];this.getView().getModel("localJson").setProperty("/BuildingSet",[]);var r=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.SelectMultiBuildingTable",this);if(!this._BuildinDialog){this._BuildinDialog=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.SelectMultiBuildingDialoge",this);this._BuildinDialog.setTable(r);this.getView().addDependent(this._BuildinDialog);t.aContexts=[];t.Boqs=[];t.BUBoQs=[]}this._BuildinDialog.open()},onBuildingContractClose:function(){this._BuildinDialog.close();this._BuildinDialog.destroy();this._BuildinDialog=null;this.Building="";this.ModelCode="";this.sProjj="";this.sProj="";this.GroupCodee="";this.GroupCode=""},cleanProjDialog:function(){this.sProjj="";this.sProj="";this.getView().byId("idSearchByProject").setValue("")},cleanSearchModel:function(){this.getView().getModel("localJson").setProperty("/selectBoq",false);this.oldmodelvalue="";this.ModelCode="";this.getView().byId("idSearchByModel").setValue("")},cleanSearGroup:function(){this.GroupCodee="";this.GroupCode="";this.getView().byId("idSearchByGroup").setValue("")},cleanSearBuilding:function(){this.Building="";this.getView().byId("_IdBuilding").setValue("")},handleOpenViewSheet:function(e){var t=e.getSource();if(!this._View2Sheet){this._View2Sheet=sap.ui.xmlfragment("com.cicre.po.view.fragments.ViewSheetDialog",this);this.getView().addDependent(this._View2Sheet)}this._View2Sheet.openBy(t)},addcontractualsc1:function(){this.getModel("localJso").setProperty("/ViewCon1",false);this.getModel("localJso").setProperty("/ViewCon2",true);this.getModel("localJso").setProperty("/ViewCon3",true)},addcontractualsc2:function(){var e=this;e.ViewCon="V2";this.Consoliatedservicesall();this.getModel("localJso").setProperty("/ViewCon1",true);this.getModel("localJso").setProperty("/ViewCon4",false);this.getModel("localJso").setProperty("/ViewCon2",false);this.getModel("localJso").setProperty("/ViewCon3",true);e.getView().setBusy(false)},addcontractualsc3:function(){this.ViewCon="V3";this.Consoliatedservicesall();this.getModel("localJso").setProperty("/ViewCon1",true);this.getModel("localJso").setProperty("/ViewCon2",true);this.getModel("localJso").setProperty("/ViewCon3",false)},onDisplaySearGroupfilter:function(e){var t=this,o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/myBuildingSet"))),i=this.getModel("localJson");var l={},s=[],n=[],d=[],u=false;if(this.ModelCodefilter.length>0)s.push(new a("Model",r.EQ,this.ModelCodefilter));if(this.BuildingCodefilter.length>0)s.push(new a("BuildingNo",r.EQ,this.BuildingCodefilter));if(this.ZoneCodefilter.length>0)s.push(new a("Project",r.EQ,this.ZoneCodefilter));this.byId("IdBuildingTable_copy").setVisibleRowCount(this.getModel("localJson").getProperty("/copymyBuildingSet").length);this.byId("IdBuildingTable_copy").getBinding("rows").filter(s);this.byId("IdBuildingTable_copy").refreshRows();var g=this.byId("IdBuildingTable_copy").getBinding("rows").getCurrentContexts();g.map(function(e){n.push(JSON.parse(JSON.stringify(i.getProperty(e.getPath()))))});var c=JSON.parse(JSON.stringify(n));n.map(function(e){u=false;l.Zzgroup=e.Zzgroup;l.GroupTxt=e.GroupTxt;l.BuildingNo=e.BuildingNo;l.Zzgroupr=e.Zzgroup+"R";c.map(function(e){if(e.Zzgroup===l.Zzgroup&&l.Zzgroup!=""){u=true;var t=false;e.Zzgroup=l.Zzgroupr}});if(u){d.push(JSON.parse(JSON.stringify(l)));c=c.filter(function(e){return e.Zzgroup!==l.Zzgroupr})}for(var t in l){delete l[t]}});i.setProperty("/Groupfilter",d);if(this._GroupDialogg){this._GroupDialogg.destroy();this._GroupDialogg=null}if(!this._GroupDialogg){this._GroupDialogg=sap.ui.xmlfragment("com.cicre.po.view.fragments.groupSearchDialogfilter",this);this.getView().addDependent(this._GroupDialogg)}var p=new sap.m.StandardListItem({title:"{localJson>Zzgroup}",description:"{localJson>GroupTxt}",type:"Active"});this._GroupDialogg.bindAggregation("items",{path:"localJson>/Groupfilter",template:p,templateShareable:false});this._GroupDialogg.open()},handleSearchGroupfilter:function(e){var t=this;var o=e.getParameter("value");var i=new sap.ui.model.Filter("Zzgroup",sap.ui.model.FilterOperator.Contains,o);var a=new sap.m.StandardListItem({title:"{localJson>Zzgroup}",description:"{localJson>GroupTxt}",type:"Active"});var r=[];if(o!==""){r.push(i)}this._GroupDialogg.bindAggregation("items",{path:"localJson>/Groupfilter",template:a,filters:r,templateShareable:false})},onSearchGroupfilter:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){t.GroupCodefilter=e.getObject().Zzgroup;t.getView().byId("onSearchGroupfilter").setValue(e.getObject().GroupTxt)})}else{t.GroupCodefilter="";t.getView().byId("onSearchGroupfilter").setValue("");sap.m.MessageToast.show("No new item was selected.")}e.getSource().getBinding("items").filter([])},onDisplaySearchModelfilter:function(e){var t=this,o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/myBuildingSet"))),i=this.getModel("localJson"),l=this.getModel("localJso"),s=[],n=[],d={},u=[],g=false;this.modelId=e.getParameters().id;if(this.BuildingCodefilter.length>0)s.push(new a("BuildingNo",r.EQ,this.BuildingCodefilter));if(this.GroupCodefilter.length>0)s.push(new a("Zzgroup",r.EQ,this.GroupCodefilter));if(this.ZoneCodefilter.length>0)s.push(new a("Project",r.EQ,this.ZoneCodefilter));this.byId("IdBuildingTable_copy").setVisibleRowCount(this.getModel("localJson").getProperty("/copymyBuildingSet").length);this.byId("IdBuildingTable_copy").getBinding("rows").filter(s);this.byId("IdBuildingTable_copy").refreshRows();var c=this.byId("IdBuildingTable_copy").getBinding("rows").getCurrentContexts();c.map(function(e){n.push(JSON.parse(JSON.stringify(i.getProperty(e.getPath()))))});var p=JSON.parse(JSON.stringify(n));n.map(function(e){g=false;d.Model=e.Model;d.ModelDesc=e.ModelDesc;d.BuildingNo=e.BuildingNo;d.Modelr=e.Model+"R";p.map(function(e){if(e.Model===d.Model&&d.Model!=""){g=true;var t=false;e.Model=d.Modelr}});if(g){u.push(JSON.parse(JSON.stringify(d)));p=p.filter(function(e){return e.Model!==d.Modelr})}for(var t in d){delete d[t]}});i.setProperty("/Modelfilter",u);if(this._ModelDialogfilter){this._ModelDialogfilter.destroy();this._ModelDialogfilter=null}if(!this._ModelDialogfilter){this._ModelDialogfilter=sap.ui.xmlfragment("com.cicre.po.view.fragments.ModelDialogfilter",this);this.getView().addDependent(this._ModelDialogfilter)}var h=new sap.m.StandardListItem({title:"{localJson>ModelDesc}",description:"{localJson>Model}",type:"Active"});this._ModelDialogfilter.bindAggregation("items",{path:"localJson>/Modelfilter",template:h,templateShareable:false});this._ModelDialogfilter.open()},handleSearchModelfilter:function(e){var t=this;var o=e.getParameter("value");var i=new sap.ui.model.Filter("Model",sap.ui.model.FilterOperator.Contains,o);var a=new sap.m.StandardListItem({title:"{localJson>ModelDesc}",description:"{localJson>Model}",type:"Active"});var r=[];if(o!==""){r.push(i)}this._ModelDialogfilter.bindAggregation("items",{path:"localJson>/Modelfilter",template:a,filters:r,templateShareable:false})},onSearchModelfilter:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){if(t.modelId==="__component0---object--idSearchByModelFilter"){t.ModelCodeFilter=e.getObject().Model;t.getView().byId("idSearchByModelFilter").setValue(e.getObject().ModelDesc)}else{t.ModelCodefilter=e.getObject().Model;t.getView().byId("onSearchModelfilter_Id").setValue(e.getObject().ModelDesc)}})}else{if(t.modelId==="__component0---object--idSearchByModelFilter"){t.ModelCodeFilter="";sap.m.MessageToast.show("No new item was selected.")}else{t.ModelCodefilter="";t.getView().byId("onSearchModelfilter_Id").setValue("")}}e.getSource().getBinding("items").filter([])},onDisplaySearchModelfilterOnBuilding:function(e){var t=this,o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/myBuildingSet"))),i=this.getModel("localJson"),a=this.getModel("localJso"),r=[],l=[],s={},n=[],d=false,u=a.getProperty("/Buildingss");this.modelId=e.getParameters().id;t.getModel("localJson").setProperty("/copymyBuildingSet",o);if(u.length>0){u.map(function(e){r.push(new sap.ui.model.Filter("BuildingNo",sap.ui.model.FilterOperator.EQ,e.BuildingNo))})}this.byId("IdBuildingTable_copy").setVisibleRowCount(this.getModel("localJson").getProperty("/copymyBuildingSet").length);this.byId("IdBuildingTable_copy").getBinding("rows").filter(r);this.byId("IdBuildingTable_copy").refreshRows();var g=this.byId("IdBuildingTable_copy").getBinding("rows").getCurrentContexts();g.map(function(e){l.push(JSON.parse(JSON.stringify(i.getProperty(e.getPath()))))});var c=JSON.parse(JSON.stringify(l));l.map(function(e){d=false;s.Model=e.Model;s.ModelDesc=e.ModelDesc;s.BuildingNo=e.BuildingNo;s.Modelr=e.Model+"R";c.map(function(e){if(e.Model===s.Model&&s.Model!=""){d=true;var t=false;e.Model=s.Modelr}});if(d){n.push(JSON.parse(JSON.stringify(s)));c=c.filter(function(e){return e.Model!==s.Modelr})}for(var t in s){delete s[t]}});i.setProperty("/Modelfilter",n);if(this._ModelDialogfilter){this._ModelDialogfilter.destroy();this._ModelDialogfilter=null}if(!this._ModelDialogfilter){this._ModelDialogfilter=sap.ui.xmlfragment("com.cicre.po.view.fragments.ModelDialogfilterBuilding",this);this.getView().addDependent(this._ModelDialogfilter)}var p=new sap.m.StandardListItem({title:"{localJson>ModelDesc}",description:"{localJson>Model}",type:"Active"});this._ModelDialogfilter.bindAggregation("items",{path:"localJson>/Modelfilter",template:p,templateShareable:false});this._ModelDialogfilter.open()},handleSearchModelBuilding:function(e){var t=this;var o=e.getParameter("value");var i=new sap.ui.model.Filter("Model",sap.ui.model.FilterOperator.Contains,o);var a=new sap.m.StandardListItem({title:"{localJson>ModelDesc}",description:"{localJson>Model}",type:"Active"});var r=[];if(o!==""){r.push(i)}this._ModelDialogfilter.bindAggregation("items",{path:"localJson>/Modelfilter",template:a,filters:r,templateShareable:false})},onSelectModelListBuilding:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){t.ModelCodeFilter=e.getObject().Model;t.getView().byId("idSearchByModelFilter").setValue(e.getObject().ModelDesc)})}else{if(t.modelId==="__component0---object--idSearchByModelFilter"){t.ModelCodeFilter="";sap.m.MessageToast.show("No new item was selected.")}else{t.ModelCodefilter="";t.getView().byId("onSearchModelfilter_Id").setValue("")}}e.getSource().getBinding("items").filter([])},changeBuildingfilter:function(){this.ModelCodefilter="";this.getView().byId("idSearchByModelFilter").setValue("")},onDisplaySearchZone:function(e){var t=this,o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/myBuildingSet"))),i=this.getModel("localJson");var l={},s=[],n=false,d=[],u=[];if(this.ModelCodefilter.length>0)d.push(new a("Model",r.EQ,this.ModelCodefilter));if(this.BuildingCodefilter.length>0)d.push(new a("BuildingNo",r.EQ,this.BuildingCodefilter));if(this.GroupCodefilter.length>0)d.push(new a("Zzgroup",r.EQ,this.GroupCodefilter));this.byId("IdBuildingTable_copy").setVisibleRowCount(this.getModel("localJson").getProperty("/copymyBuildingSet").length);this.byId("IdBuildingTable_copy").getBinding("rows").filter(d);this.byId("IdBuildingTable_copy").refreshRows();var g=this.byId("IdBuildingTable_copy").getBinding("rows").getCurrentContexts();g.map(function(e){u.push(JSON.parse(JSON.stringify(i.getProperty(e.getPath()))))});var c=JSON.parse(JSON.stringify(u));u.map(function(e){n=false;l.Project=e.Project;l.ZoneTxt=e.ZoneTxt;l.BuildingNo=e.BuildingNo;l.Projectr=e.Project+"R";c.map(function(e){if(e.Project===l.Project&&l.Project!=""){n=true;e.Project=l.Projectr}});if(n){s.push(JSON.parse(JSON.stringify(l)));c=c.filter(function(e){return e.Project!==l.Projectr})}for(var t in l){delete l[t]}});i.setProperty("/Zonefilter",s);if(this._ZoneDialogfilter){this._ZoneDialogfilter.destroy();this._ZoneDialogfilter=null}if(!this._ZoneDialogfilter){this._ZoneDialogfilter=sap.ui.xmlfragment("com.cicre.po.view.fragments.ZoneSearchDialogfilter",this);this.getView().addDependent(this._ZoneDialogfilter)}var p=new sap.m.StandardListItem({title:"{localJson>ZoneTxt}",description:"{localJson>Project}",type:"Active"});this._ZoneDialogfilter.bindAggregation("items",{path:"localJson>/Zonefilter",template:p,templateShareable:false});this._ZoneDialogfilter.open()},handleSearchZonefilter:function(e){var t=this;var o=e.getParameter("value");var i=new sap.ui.model.Filter("Project",sap.ui.model.FilterOperator.Contains,o);var a=new sap.m.StandardListItem({title:"{localJson>ZoneTxt}",description:"{localJson>Project}",type:"Active"});var r=[];if(o!==""){r.push(i)}this._ZoneDialogfilter.bindAggregation("items",{path:"localJson>/Zonefilter",template:a,filters:r,templateShareable:false})},onSearchZonefilter:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){t.ZoneCodefilter=e.getObject().Project;t.getView().byId("onSearchZonefilter_Id").setValue(e.getObject().ZoneTxt)})}else{t.ZoneCodefilter="";t.getView().byId("onSearchZonefilter_Id").setValue("");sap.m.MessageToast.show("No new item was selected.")}e.getSource().getBinding("items").filter([])},onDisplaySearBuildingfilter:function(e){var t=this,o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/myBuildingSet"))),i=this.getModel("localJson");var l={},s=JSON.parse(JSON.stringify(o)),n=[],d=[],u=[],g=false;if(this.ModelCodefilter.length>0)d.push(new a("Model",r.EQ,this.ModelCodefilter));if(this.GroupCodefilter.length>0)d.push(new a("Zzgroup",r.EQ,this.GroupCodefilter));if(this.ZoneCodefilter.length>0)d.push(new a("Project",r.EQ,this.ZoneCodefilter));this.byId("IdBuildingTable_copy").setVisibleRowCount(this.getModel("localJson").getProperty("/copymyBuildingSet").length);this.byId("IdBuildingTable_copy").getBinding("rows").filter(d);this.byId("IdBuildingTable_copy").refreshRows();var c=this.byId("IdBuildingTable_copy").getBinding("rows").getCurrentContexts();c.map(function(e){u.push(JSON.parse(JSON.stringify(i.getProperty(e.getPath()))))});var s=JSON.parse(JSON.stringify(u));u.map(function(e){g=false;l.BuildingTxt=e.BuildingTxt;l.BuildingNo=e.BuildingNo;l.BuildingNor=e.BuildingNo+"R";s.map(function(e){if(e.BuildingNo===l.BuildingNo&&l.BuildingNo!=""){g=true;e.BuildingNo=l.BuildingNor}});if(g){n.push(JSON.parse(JSON.stringify(l)));s=s.filter(function(e){return e.BuildingNo!==l.BuildingNor})}for(var t in l){delete l[t]}});i.setProperty("/Buildingfilter",n);if(this._BuildingDialogfilter){this._BuildingDialogfilter.destroy();this._BuildingDialogfilter=null}if(!this._BuildingDialogfilter){this._BuildingDialogfilter=sap.ui.xmlfragment("com.cicre.po.view.fragments.BuildingSearchDialogfilter",this);this.getView().addDependent(this._BuildingDialogfilter)}var p=new sap.m.StandardListItem({title:"{localJson>BuildingTxt}",description:"{localJson>BuildingNo}",type:"Active"});this._BuildingDialogfilter.bindAggregation("items",{path:"localJson>/Buildingfilter",template:p,templateShareable:false});this._BuildingDialogfilter.open()},handleSearchBilddingfilter:function(e){var t=this;var o=e.getParameter("value");var i=new sap.ui.model.Filter("BuildingTxt",sap.ui.model.FilterOperator.Contains,o);var a=new sap.ui.model.Filter("BuildingNo",sap.ui.model.FilterOperator.Contains,o);var r=new sap.m.StandardListItem({title:"{localJson>BuildingTxt}",description:"{localJson>BuildingNo}",type:"Active"});var l=[];if(o!==""){l.push(i)}if(o!==""){l.push(a)}this._BuildingDialogfilter.bindAggregation("items",{path:"localJson>/Buildingfilter",template:r,filters:l,templateShareable:false})},onSearchBuildingfilter:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){t.BuildingCodefilter=e.getObject().BuildingNo;t.getView().byId("onSearchBildingfilter_Id").setValue(e.getObject().BuildingTxt)})}else{t.BuildingCodefilter="";t.getView().byId("onSearchBildingfilter_Id").setValue("");sap.m.MessageToast.show("No new item was selected.")}e.getSource().getBinding("items").filter([])},changeModel:function(){this.ModelCodefilter="";that.getView().byId("onSearchModelfilter_Id").setValue("")},changeZone:function(){this.ZoneCodefilter="";that.getView().byId("onSearchZonefilter_Id").setValue("")},changeGroup:function(){this.GroupCodefilter="";that.getView().byId("onSearchGroupfilter").setValue("")},changeBuilding:function(){this.BuildingCodefilter="";that.getView().byId("onSearchBildingfilter_Id").setValue("")},onFilterServices:function(e){this.ViewCon="V";if(e.getParameters().id==="__component0---object--forBBuildingConsulidatedItemSet"){this.getModel("localJso").setProperty("/ViewCon4",false);this.getModel("localJso").setProperty("/ViewCon2",false)}this.selectedTableId=e.getSource().getParent().getParent().getId().substring(e.getSource().getParent().getParent().getId().lastIndexOf("-")+1);if(!this._filterDialog){this._filterDialog=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.FilterServices",this);this.getView().addDependent(this._filterDialog)}this._filterDialog.open()},onBuildingValueHelpPress:function(){var e=this,t=JSON.parse(JSON.stringify(e.getView().getModel("localJson").getProperty("/myBuildingSet")));e.getModel("localJson").setProperty("/copymyBuildingSet",t);if(e.sProjectCode!==""&&e.sCoCode!==""){var o=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.BuildingValueHelpFilterBarTable",this);if(!this._oBuildingValueHelpDialog){this._oBuildingValueHelpDialog=sap.ui.xmlfragment(this.getView().getId(),"com.cicre.po.view.fragments.BuildingValueHelpFilterBarDialog",this);this._oBuildingValueHelpDialog.setTable(o);this.getView().addDependent(this._oBuildingValueHelpDialog)}this._oBuildingValueHelpDialog.open();if(e._oBuildingValueHelpDialog.getModel("localJson")){this.getView().getModel("localJson").setProperty("/BuildingFilterSet",[]);this.getView().getModel("localJson").setProperty("/WBSFilterSet",[]);this.getView().getModel("localJson").setProperty("/BuildingWBSFilterSet",[])}}else{sap.m.MessageToast.show("Please select Company Code and Project first.")}},CancelPressBuilding:function(){this.ModelCodefilter="";this.ZoneCodefilter="";this.GroupCodefilter="";this.BuildingCodefilter="";this._oBuildingValueHelpDialog.close();this._oBuildingValueHelpDialog.destroy();this._oBuildingValueHelpDialog=null},onDisplaySearchModel:function(e){this.idSelectModel=e.getSource().getId();if(!this._ModelDialogFilter){this._ModelDialogFilter=sap.ui.xmlfragment("com.cicre.po.view.fragments.ModelSearchDialog",this);this._ModelDialogFilter.setModel(this.getView().getModel())}this._ModelDialogFilter.open();var t=new sap.m.StandardListItem({title:"{IdText}",description:"{IdNumber}"});var o=[];var i=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"Model");var a=new sap.ui.model.Filter("SelectionParameter",sap.ui.model.FilterOperator.Contains,this.sCoCode);var r=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var l=new sap.ui.model.Filter("SelectionParameter4",sap.ui.model.FilterOperator.EQ,this.sProj);var s=new sap.ui.model.Filter("SelectionParameter5",sap.ui.model.FilterOperator.EQ,this.Building);var n=new sap.ui.model.Filter("SelectionParameter6",sap.ui.model.FilterOperator.Contains,this.GroupCode);o.push(i);o.push(a);o.push(r);if(this.sProj.length>0){o.push(l)}if(this.Building.length>0){o.push(s)}if(this.GroupCode.length>0){o.push(n)}this._ModelDialogFilter.bindAggregation("items",{path:"/ValueHelpSet",template:t,filters:o})},handleSearchModel:function(e){var t=e.getParameter("value");var o=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"Model");var i=new sap.ui.model.Filter("SelectionParameter",sap.ui.model.FilterOperator.EQ,this.sCoCode);var a=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var r=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.Contains,t);var l=new sap.ui.model.Filter("SelectionParameter4",sap.ui.model.FilterOperator.EQ,this.sProj);var s=new sap.ui.model.Filter("SelectionParameter5",sap.ui.model.FilterOperator.EQ,this.Building);var n=new sap.ui.model.Filter("SelectionParameter6",sap.ui.model.FilterOperator.Contains,this.GroupCode);var d=new sap.m.StandardListItem({title:"{IdText}",description:"{IdNumber}"});var u=[];u.push(o);if(this.sCoCode.length>0){u.push(i)}if(this.sProj.length>0){u.push(l)}if(this.sProjectCode.length>0){u.push(a)}if(t.length>0){u.push(r)}if(this.Building.length>0){u.push(s)}if(this.GroupCode.length>0){u.push(n)}this._ModelDialogFilter.bindAggregation("items",{path:"/ValueHelpSet",template:d,filters:u})},onSelectModelList:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){if(t.idSelectModel.substring(t.idSelectModel.lastIndexOf("-")+1)==="idSearchByModel"){t.ModelCodee=e.getObject().IdNumber;t.getView().byId("idSearchByModel").setValue(e.getObject().IdText)}else if(t.idSelectModel.substring(t.idSelectModel.lastIndexOf("-")+1)==="idSearchByModelFilter"){t.ModelCodeFilter=e.getObject().IdNumber;t.getView().byId("idSearchByModelFilter").setValue(e.getObject().IdText)}else{t.getView().byId("idSearchByModel").setValue(e.getObject().IdText)}})}else{t.ModelCodee="";t.getView().byId("idSearchByModel").setValue("");sap.m.MessageToast.show("No new item was selected.")}e.getSource().getBinding("items").filter([])},handleSearchBuildingPressFilter:function(){var e=this,t=JSON.parse(JSON.stringify(e.getView().getModel("localJson").getProperty("/myBuildingSet"))),o=JSON.parse(JSON.stringify(e.getView().getModel("localJson").getProperty("/myWBSSet"))),i=this.getView().byId("idBuildingCategory").getSelectedKeys(),a=e.getOwnerComponent().getModel(),e=this,r=false,l=[],s=[];i.map(function(i){if(i=="BUILD"){var a=[];if(e.GroupCodefilter.length<3&&e.GroupCodefilter.length!=0){e.GroupCodefilter="0"+e.GroupCodefilter}var n=e.getOwnerComponent().getModel();var d=new sap.ui.model.Filter("Zone",sap.ui.model.FilterOperator.EQ,e.ZoneCodefilter);var u=new sap.ui.model.Filter("CompCode",sap.ui.model.FilterOperator.EQ,e.sCoCode);var g=new sap.ui.model.Filter("BuildingNo",sap.ui.model.FilterOperator.EQ,e.BuildingCodefilter);var c=new sap.ui.model.Filter("Project",sap.ui.model.FilterOperator.EQ,e.sProjectCode);var p=new sap.ui.model.Filter("Group",sap.ui.model.FilterOperator.EQ,e.GroupCodefilter);var h=new sap.ui.model.Filter("Model",sap.ui.model.FilterOperator.EQ,e.ModelCodefilter);if(e.ZoneCodefilter!=="")a.push(d);if(e.BuildingCodefilter!=="")a.push(g);if(e.GroupCodefilter!==""){a.push(p)}if(e.ModelCodefilter!==""){a.push(h)}a.push(u);a.push(c);n.read("/BuildingSet",{filters:a,success:function(o){$.each(o.results,function(e,t){var o={BuildingNo:t.BuildingNo,ModelDesc:t.ModelDesc,Model:"00000"+t.Model,Group:t.Group};l.push(o)});$.each(t,function(e,t){var o=false;$.each(l,function(e,i){if(i.BuildingNo===t.BuildingNo){o=true;$.each(s,function(e,t){if(i.BuildingNo===t.BuildingNo)o=false})}});if(o){s.push(t)}});e.getView().getModel("localJson").setProperty("/BuildingFilterSet",s)},error:function(e){sap.m.MessageToast.show("Error")}})}if(i=="WBS"){if(e.sProjectCode!==""&&e.sCoCode!==""){var n=e.getView().getModel();var a=[];var d=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"WBS");var u=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,e.sCoCode);var g=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.EQ,e.sProjectCode);a.push(d);a.push(u);a.push(g);n.read("/ValueHelpSet",{filters:a,success:function(t){r=true;$.each(t.results,function(e,o){t.results[e].Group="";t.results[e].Model=t.results[e].IdNumber});$.each(t.results,function(e,t){var o={BuildingNo:t.IdNumber,ModelDesc:t.IdText,Model:t.IdNumber};l.push(o)});$.each(o,function(e,t){var o=false;$.each(l,function(e,i){if(i.BuildingNo===t.BuildingNo){o=true}$.each(s,function(e,t){if(i.BuildingNo===t.BuildingNo)o=false})});if(o){s.push(t)}});var i=JSON.parse(JSON.stringify(l));e.getView().getModel("localJson").setProperty("/BuildingFilterSet",s)},error:function(e){sap.m.MessageToast.show("Error")}})}else{sap.m.MessageToast.show("Please select Company Code and Project first.")}}})},onBuildingValueHelpOkPress:function(){var e=this.getModel("localJso"),t=this._oBuildingValueHelpDialog.getTable().getSelectedIndices(),o=[];if(t.length>0){for(var i=0;i<t.length;i++){var a=this._oBuildingValueHelpDialog.getTable().getContextByIndex(t[i]).getObject();o.push(a)}e.setProperty("/Buildingss",o);e.refresh()}this.CancelPressBuilding()},onApplyFilter:function(){var e=this;var t=[],o=[],i=this.getModel("localJso"),a=i.getProperty("/Buildingss"),r=this.getView().getModel("localJson"),l=this.byId("idFContractualIndicator").getSelectedKeys(),s="00000"+e.ModelCodeFilter;if(a.length>0){a.map(function(e){t.push(new sap.ui.model.Filter("Buildingno",sap.ui.model.FilterOperator.EQ,e.BuildingNo))})}if(l.length>0){l.map(function(e){t.push(new sap.ui.model.Filter("ContractualIndicator",sap.ui.model.FilterOperator.EQ,e))})}if(s!=="00000"){t.push(new sap.ui.model.Filter("Model",sap.ui.model.FilterOperator.EQ,s))}if(this.getModel("localJso").getProperty("/ViewCon3")==false){var n="idConsuliatedTableGroup"}if(this.getModel("localJso").getProperty("/ViewCon2")==false){var n="idConsuliatedTable"}e.Consoliatedservicesall();if(this._filterDialog){this._filterDialog.destroy();this._filterDialog=null}},onClearFilter:function(e){var t=this;var o=this.getModel("localJson");var i=this.getModel("localJso");o.refresh();this.byId("idFContractualIndicator").setSelectedKeys();o.setProperty("/Buildingss",[]);i.setProperty("/Buildingss",[]);t.ModelCodeFilter="";i.refresh();t.Consoliatedservicesall();if(this.getModel("localJso").getProperty("/ViewCon2")==="false"){var a="idConsuliatedTable"}else{a="idConsuliatedTableGroup"}if(this._filterDialog){this._filterDialog.destroy();this._filterDialog=null}},groupConsolidscreen2:function(e){var t={},o=JSON.parse(JSON.stringify(e)),i=[],a=this.getModel("localJson"),r=false;e.map(function(e){r=false;t.ContractualIndicator=e.ContractualIndicator;t.Boq=e.Boq;t.sortNum=e.sortNum;t.Data=e.Data;t.LongDesc=e.LongDesc;t.ShortDesc=e.ShortDesc;t.Uom=e.Uom;t.Qty=0;t.Eancat=e.Eancat;t.PriceUnit=e.PriceUnit;t.Txt=e.Txt;t.ContractualIndicatorr=e.ContractualIndicator+"R";t.Datar=e.Data+"R";t.Txtr=e.Txt+"R";t.MatlGroup=e.MatlGroup;t.Amount=0;t.Buildings=[];o.map(function(e){if(e.Data===t.Data&&e.Txt===t.Txt){r=true;var o=false;t.Amount+=parseFloat(e.Amount);t.Qty+=parseFloat(e.Qty);e.ContractualIndicator=t.ContractualIndicatorr;e.Data=t.Datar;e.Txt=t.Txtr;t.Buildings.map(function(t){if(t===e.Buildingno){o=true}});if(!o){t.Buildings.push(e.Buildingno)}}});if(r){t.Buildingno=t.Buildings.length.toString();i.push(JSON.parse(JSON.stringify(t)));o=o.filter(function(e){return e.Data!==t.Datar&&e.Txt!==t.Txtr})}for(var a in t){delete t[a]}});a.setProperty("/forBBuildingConsulidatedItemSet",JSON.parse(JSON.stringify(i.sort((e,t)=>e.Data-t.Data))))},_WholeContract:function(){this.onClearFilter();this._filterDialog.close()},WholeContractservices:function(e){var t={},o=JSON.parse(JSON.stringify(e)),i=[],a=this.getModel("localJson"),r=false;e.map(function(e){r=false;t.ContractualIndicator=e.ContractualIndicator;t.Boq=e.Boq;t.Data=e.Data;t.sortNum=e.sortNum;t.ShortDesc=e.ShortDesc;t.Uom=e.Uom;t.Qty=0;t.Eancat=e.Eancat;t.PriceUnit=e.PriceUnit;t.Txt=e.Txt;t.ContractualIndicatorr=e.ContractualIndicator+"R";t.Datar=e.Data+"R";t.Txtr=e.Txt+"R";t.MatlGroup=e.MatlGroup;t.Amount=0;t.Buildings=[];o.map(function(e){if(e.Data===t.Data&&e.Txt===t.Txt){r=true;var o=false;t.Amount+=parseFloat(e.Qty*e.PriceUnit);t.Qty+=parseFloat(e.Qty);e.ContractualIndicator=t.ContractualIndicatorr;e.Data=t.Datar;e.Txt=t.Txtr;t.Buildings.map(function(t){if(t===e.Buildingno){o=true}});if(!o){t.Buildings.push(e.Buildingno)}}});if(r){t.Buildingno=t.Buildings.length;i.push(JSON.parse(JSON.stringify(t)));o=o.filter(function(e){return e.Data!==t.Datar&&e.Txt!==t.Txtr})}for(var a in t){delete t[a]}});a.setProperty("/forBBuildingConsulidatedItemSet",JSON.parse(JSON.stringify(i.sort((e,t)=>e.Data-t.Data))))},groupConsolidscreen3all:function(e){var t={},o=JSON.parse(JSON.stringify(e)),i=[],a=this.getModel("localJson"),r=false;e.map(function(e){r=false;t.ContractualIndicator=e.ContractualIndicator;t.Boq=e.Boq;t.Txt=e.Txt;t.ItemCat=e.ItemCat;t.Buildingno=e.Buildingno;t.Buildingnum=0;t.sortNum=e.sortNum;t.ContractualIndicatorr=e.ContractualIndicator+"R";t.MatlGroupr=e.MatlGroup+"R";t.Boqr=e.Boq+"R";t.Txtr=e.Txt+"R";t.Buildingnor=e.Buildingno+"R";t.MatlGroup=e.MatlGroup;t.Boq=e.Boq;t.Matdesc=e.Matdesc;t.Amount=0;t.Buildings=[];o.map(function(e){if(e.MatlGroup===t.MatlGroup&&e.Boq===t.Boq&&e.ItemCat!=="U"&&e.Txt===t.Txt&&e.Buildingno===t.Buildingno){r=true;var o=false;t.Amount+=parseFloat(e.Qty*e.PriceUnit);e.ContractualIndicator=t.ContractualIndicatorr;e.MatlGroup=t.MatlGroupr;e.Txt=t.Txtr;e.Buildingno=t.Buildingnor;t.Buildings.map(function(t){if(t===e.Buildingno){o=true}});if(!o){t.Buildings.push(e.Buildingno)}}});if(r){t.Buildingnum=t.Buildings.length;i.push(JSON.parse(JSON.stringify(t)));o=o.filter(function(e){return e.MatlGroup!==t.MatlGroupr&&e.Boq!==t.Boqr&&e.Txt!==t.Txtr&&e.Buildingno!==t.Buildingnor})}for(var a in t){delete t[a]}});a.setProperty("/ServiceGroupSet",i);return i},groupConsolidscreen3:function(e){var t={},o=JSON.parse(JSON.stringify(e)),i=[],a=this.getModel("localJson"),r=false;e.map(function(e){r=false;t.ContractualIndicator=e.ContractualIndicator;t.Boq=e.Boq;t.MatlGroup=e.MatlGroup;t.Txt=e.Txt;t.Buildingno=e.Buildingno;t.sortNum=e.sortNum;t.ContractualIndicatorr=e.ContractualIndicator+"R";t.MatlGroupr=e.MatlGroup+"R";t.Txtr=e.Txt+"R";t.Buildingnum=0;t.Matdesc=e.Matdesc;t.Matdesc=e.Matdesc;t.Amount=0;t.Buildings=[];o.map(function(e){if(e.MatlGroup===t.MatlGroup&&e.Txt===t.Txt&&e.Eancat!="C"&&e.Eancat!="U"){r=true;var o=false;t.Amount=parseFloat(t.Amount)+parseFloat(e.Amount);e.ContractualIndicator=t.ContractualIndicatorr;e.MatlGroup=t.MatlGroupr;e.Txt=t.Txtr;t.Buildings.map(function(t){if(t===e.Buildingno){o=true}});if(!o){t.Buildings.push(e.Buildingno)}}});if(r){t.Buildingnum=t.Buildings.length;i.push(JSON.parse(JSON.stringify(t)));o=o.filter(function(e){return e.MatlGroup!==t.MatlGroupr&&e.Txt!==t.Txtr})}for(var a in t){delete t[a]}});a.setProperty("/ServiceGroupSet",i)},onCancelFilter:function(){this._filterDialog.close();this._filterDialog.destroy();this._filterDialog=null},ContractValueHeader:function(){var e=this,t=this.getModel("localJson"),o="0.00",i="0.00",a="0.00",r="0.00",l="0.00",s="0.00",n="0.00",d="0.00",u=t.getProperty("/myBuildingSet"),g=t.getProperty("/myWBSSet"),c="0.00",p="0.00",h="0.00",f=JSON.parse(JSON.stringify(this.getModel("localJson").getProperty("/BoqConsulidatedItemSet"))),m=JSON.parse(JSON.stringify(this.getModel("localJson").getProperty("/EstimatedContracts"))),S=JSON.parse(JSON.stringify(e.getModel("localJson").getProperty("/HeadToHeadVariation")));$.each(g,function(e,t){p=parseFloat(p)+1});$.each(u,function(e,t){c=parseFloat(c)+1});$.each(f,function(e,t){h=parseFloat(h)+1});$.each(f,function(e,t){if(t.ContractualIndicator==="O"&&t.Eancat!=="C"&&t.Eancat!=="U"){i=(parseFloat(i)+parseFloat(t.Amount)).toString()}else if(t.ContractualIndicator==="V"&&t.Eancat!=="C"&&t.Eancat!=="U"){a=(parseFloat(a)+parseFloat(t.Amount)).toString()}else if(t.ContractualIndicator==="A"&&t.Eancat!=="C"&&t.Eancat!=="U"){r=(parseFloat(r)+parseFloat(t.Amount)).toString()}$.each(S,function(e,o){if(o.Status==="C"&&t.Txt===(o.OrderType+"-"+o.UserOrder).toString()){if(t.Eancat!=="C"&&t.Eancat!=="U"&&t.Qty>=0){s=parseFloat(s)+parseFloat(t.Amount)}if(t.Eancat!=="C"&&t.Eancat!=="U"&&t.Qty<0){n=parseFloat(n)+parseFloat(t.Amount)}}})});$.each(m,function(e,t){if(t.DelInd!=="X"){o=parseFloat(o)+parseFloat(t.Amount)}});var C="";d=parseFloat(s)+parseFloat(n);$.each(S,function(t,o){if(o.Status==="C"){o.AddValues=s.toString();o.OmissionValues=n.toString();o.ChangeAmount=d.toString();o.ChangeInd="X";C=t;e.getModel("localJson").setProperty("/HeadToHeadVariation/"+t,o)}});l=(parseFloat(i)+parseFloat(a)+parseFloat(r)).toString();this.getView().getModel("localJson").setProperty("/EstimatedContractValue",parseFloat(o).toFixed(this.CustomCurrency));this.getView().getModel("localJson").setProperty("/OriginalContractValue",parseFloat(i).toFixed(this.CustomCurrency));this.getView().getModel("localJson").setProperty("/VariationOrderValue",parseFloat(a).toFixed(this.CustomCurrency));this.getView().getModel("localJson").setProperty("/AddendumValue",parseFloat(r).toFixed(this.CustomCurrency));this.getView().getModel("localJson").setProperty("/TotalContractValue",parseFloat(l).toFixed(this.CustomCurrency));t.setProperty("/WbslistNo",p);t.setProperty("/BuildingNO",c);t.setProperty("/ServicNOCount",h);t.refresh();e.getView().setBusy(false)},ContractValueHeaderCreate:function(){var e=this.getModel("localJson"),t="0.00",o="0.00",i="0.00",a="0.00",r="0.00",l=JSON.parse(JSON.stringify(this.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet"))),s=JSON.parse(JSON.stringify(this.getView().getModel("localJson").getProperty("/EstimatedContracts")));$.each(l,function(e,t){if(t.ContractualIndicator==="O"&&t.Eancat!=="C"&&t.Eancat!=="U"&&t.DelInd!=="Y"){o=(parseFloat(o)+parseFloat(t.Amount)).toString()}else if(t.ContractualIndicator==="V"&&t.Eancat!=="C"&&t.Eancat!=="U"&&t.DelInd!=="Y"){i=(parseFloat(i)+parseFloat(t.Amount)).toString()}else if(t.ContractualIndicator==="A"&&t.Eancat!=="C"&&t.Eancat!=="U"&&t.DelInd!=="Y"){a=(parseFloat(a)+parseFloat(t.Amount)).toString()}});$.each(s,function(e,o){t=(parseFloat(t)+parseFloat(o.Amount)).toString()});r=(parseFloat(o)+parseFloat(i)+parseFloat(a)).toString();this.getView().getModel("localJson").setProperty("/EstimatedContractValue",t);this.getView().getModel("localJson").setProperty("/OriginalContractValue",o);this.getView().getModel("localJson").setProperty("/TotalContractValue",r)},onAddWBSB:function(){var e=this;if(e.sProjectCode!==""&&e.sCoCode!==""){if(!e._oWBS2Dialog){e._oWBS2Dialog=sap.ui.xmlfragment("com.cicre.po.view.fragments.SelectMultiWBS",e);var t=new sap.ui.model.resource.ResourceModel({bundleUrl:"i18n/i18n.properties"});e._oWBS2Dialog.setModel(t,"i18n");e._oWBS2Dialog.setModel(e.getView().getModel())}e._oWBS2Dialog.open();var o=e.getView().getModel();var i=new sap.ui.model.json.JSONModel;i.setData({WBSSet:[],BuildingSetfilter:[]});e._oWBS2Dialog.setModel(i,"localJson");var a=[];var r=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"WBS");var l=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,this.sCoCode);var s=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.EQ,this.sProjectCode);a.push(r);a.push(l);a.push(s);o.read("/ValueHelpSet",{filters:a,success:function(t){$.each(t.results,function(e,o){t.results[e].Group="";t.results[e].Model=t.results[e].IdNumber});var o=JSON.parse(JSON.stringify(t.results));e._oWBS2Dialog.getModel("localJson").setProperty("/WBSSet",o)},error:function(e){sap.m.MessageToast.show("Error")}});e.aContexts=[];e.Boqs=[];e.BUBoQs=[];e.WBSBoQs=[]}else{sap.m.MessageToast.show("Please select Company Code and Project first.")}},changestatus:function(e){var t=this;var o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/myBuildingSet")));var i=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/BoqItemSet")));var a=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet")));$.each(a,function(t,a){$.each(i,function(t,r){$.each(r.Categories,function(r,l){$.each(l.Categories,function(l,s){$.each(s.Categories,function(s,n){if(a.Txt===n.Txt&&e.Txt===n.Txt){var d=false;$.each(o,function(e,t){if((t.Model.length===8?t.Model:"00000"+t.Model)===n.Boq){d=true;if(t.SrvStatus==="UA"){t.SrvStatus="A"}else if(t.SrvStatus==="UD"){t.SrvStatus="D"}}});if(d){if(i[t].Categories[r].Categories[l].Categories[s].SrvStatus==="UA"){i[t].Categories[r].Categories[l].Categories[s].SrvStatus="A";i[t].Categories[r].Categories[l].Categories[s].ChangeIndicator="ChangeP"}else if(i[t].Categories[r].Categories[l].Categories[s].SrvStatus==="UD"){i[t].Categories[r].Categories[l].Categories[s].SrvStatus="D";i[t].Categories[r].Categories[l].Categories[s].ChangeIndicator="ChangeP"}}}})})})})});t.getView().getModel("localJson").setProperty("/BoqItemSet",JSON.parse(JSON.stringify(i)));t.getView().getModel("localJson").setProperty("/myBuildingSet",JSON.parse(JSON.stringify(o)))},deletesrv:function(e){var t=this;this.deleteVariation(e);var o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/BoqItemSet")));var i=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet")));var l="0.00",s="0.00",n="0.00",d=false;var u=t.getModel("localJson").getProperty("/HeadToHeadVariation");var g=this.getView().getModel("localJson").getProperty("/myBuildingSet");var c=this.getView().getModel("localJson").getProperty("/myWBSSet");var p=[];$.each(g,function(e,t){p.push(t)});$.each(c,function(e,t){p.push(t)});$.each(p,function(t,o){if(o.Group===e.Group&&e.Model===o.Model&&o.DelInd!=="Y"&&o.AsBuild2===""){d=true}});$.each(i,function(i,a){$.each(o,function(i,r){$.each(r.Categories,function(l,s){var n=0;$.each(r.Categories,function(e,t){if(t.DelInd!=="Y"){n=n+1}});if(n===1&&s.Data===e.Group&&(s.Model.length===8?s.Model:"00000"+s.Model)===e.Boq&&!d){o[i].DelInd="Y"}$.each(s.Categories,function(r,n){$.each(n.Categories,function(n,u){if(a.Data===u.Data&&a.Txt===u.Txt){var g=false;$.each(p,function(t,o){if(s.Data===e.Group&&o.Model===e.Model&&o.AsBuild2===""){if((o.Model.length===8?o.Model:"00000"+o.Model)===u.Model&&u.Model===(e.Model.length===8?e.Model:"00000"+e.Model)){g=true}}});if(g){if(!d){o[i].Categories[l].Categories[r].Categories[n].DelInd="Y";o[i].Categories[l].Categories[r].Categories[n].SrvStatus="D";o[i].Categories[l].DelInd="Y";o[i].Categories[l].Categories[r].DelInd="Y"}u.Group=e.Group;u.Buildingno=e.BuildingNo;u.SubModel=e.SubBoq;t.deleteserviceFromConsolidate(u)}}})})})})});n=parseFloat(l)+parseFloat(s);$.each(u,function(e,o){if(o.Status==="C"){o.AddValues=parseFloat(o.AddValues)-parseFloat(l);o.OmissionValues=parseFloat(o.OmissionValues)-parseFloat(s);o.ChangeAmount=parseFloat(o.ChangeAmount)-parseFloat(n);o.ChangeInd="X";t.getModel("localJson").setProperty("/HeadToHeadVariation"+e,o)}});var h=[];h.push(new sap.ui.model.Filter("DelInd",sap.ui.model.FilterOperator.NE,"Y"));t.getView().getModel("localJson").setProperty("/BoqItemSet",JSON.parse(JSON.stringify(o)));t.getView().getModel("localJson").refresh();t.byId("TreeTableBasic").getBinding("rows").filter(new a("DelInd",r.NE,"Y"));t.getView().getModel("localJson").refresh();t.byId("IdBuildingTable").getBinding("rows").filter(new a("DelInd",r.NE,"Y"));t.byId("IdWBSTable").getBinding("rows").filter(new a("DelInd",r.NE,"Y"));var f=[];var i=JSON.parse(JSON.stringify(this.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet")));var p=t.getView().getModel("localJson").getProperty("/selectedBuilding");$.each(i,function(e,t){if(t.condelete!=="DD"){f.push(t)}});this.getView().getModel("localJson").setProperty("/BoqConsulidatedItemSet",JSON.parse(JSON.stringify(f.sort((e,t)=>e.Data-t.Data))));this.BoqItemSetCalculate()},deletesrvv:function(e){var t=this;var o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/BoqItemSet")));var i=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet")));var a="0.00",r="0.00",l="0.00";var s=t.getModel("localJson").getProperty("/HeadToHeadVariation");var n=this.getView().getModel("localJson").getProperty("/myBuildingSet");var d=this.getView().getModel("localJson").getProperty("/myWBSSet");var u=[];$.each(n,function(e,t){u.push(t)});$.each(d,function(e,t){u.push(t)});$.each(i,function(i,a){$.each(o,function(i,r){$.each(r.Categories,function(l,s){var n=0;$.each(r.Categories,function(e,t){if(t.DelInd!=="Y"){n=n+1}});if(n===1&&s.Name===e.Group&&s.Boq===e.Boq){o[i].DelInd="Y"}$.each(s.Categories,function(r,n){$.each(n.Categories,function(n,d){if(a.Serviceno===d.Serviceno&&a.Txt===d.Txt&&d.SrvStatus==="UA"){var g=false;$.each(u,function(t,o){if((o.Model.length===8?o.Model:"00000"+o.Model)===d.Boq&&s.Name===e.Group&&(o.Model.length===8?o.Model:"00000"+o.Model)===e.Boq){g=true}});if(g){if(o[i].Categories[l].Categories[r].Categories[n].SrvStatus==="UA"){o[i].Categories[l].Categories[r].Categories[n].DelInd="Y";o[i].Categories[l].Categories[r].Categories[n].SrvStatus="D";o[i].Categories[l].DelInd="Y";o[i].Categories[l].Categories[r].DelInd="Y";t.deleteserviceFromConsolidate(d)}}}})})})})});l=parseFloat(a)+parseFloat(r);$.each(s,function(e,o){if(o.Status==="C"){o.AddValues=parseFloat(o.AddValues)-parseFloat(a);o.OmissionValues=parseFloat(o.OmissionValues)-parseFloat(r);o.ChangeAmount=parseFloat(o.ChangeAmount)-parseFloat(l);o.ChangeInd="X";t.getModel("localJson").setProperty("/HeadToHeadVariation"+e,o)}});this.getView().getModel("localJson").setProperty("/myBuildingSet",n);this.getView().getModel("localJson").setProperty("/myWBSSet",d);var g=[];g.push(new sap.ui.model.Filter("DelInd",sap.ui.model.FilterOperator.NE,"Y"));t.getView().getModel("localJson").setProperty("/BoqItemSet",JSON.parse(JSON.stringify(o)));t.getView().getModel("localJson").refresh();t.byId("TreeTableBasic").bindRows({path:"localJson>/BoqItemSet",filters:g,parameters:{arrayNames:"Categories"}});t.getView().getModel("localJson").refresh();this.byId("IdBuildingTable").getBinding("items").filter(g);this.byId("IdWBSTable").getBinding("items").filter(g);var c=[];var i=JSON.parse(JSON.stringify(this.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet")));$.each(i,function(e,t){if(t.Qty!==0){c.push(t)}});this.getView().getModel("localJson").setProperty("/BoqConsulidatedItemSet",JSON.parse(JSON.stringify(c.sort((e,t)=>e.Data-t.Data))));this.BoqItemSetCalculate()},deleteVariation:function(e){var t=this;var o=t.getModel("localJson").getProperty("/HeadToHeadVariation"),i=t.getView().getModel("localJson").getProperty("/variationBuilding"),a=false,r=t.getModel("localJson");$.each(o,function(t,o){if(o.Status==="C"){$.each(o.OrderItemsSet,function(t,o){if(o.Boq===e.Group&&o.BuildingNo===e.BuildingNo&&(o.Model.length===8?o.Model:"00000"+o.Model)===(e.Boq.length===8?e.Boq:"00000"+e.Boq)){o.DeleteInd="Y";o.Group=o.Boq;i.push(o)}})}});t.getView().getModel("localJson").setProperty("/variationBuilding",i)},deleteserviceFromConsolidate:function(e){var t=[];var o=JSON.parse(JSON.stringify(this.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet")));e=e;$.each(o,function(t,o){if(e.Txt===o.Txt&&e.Data===o.Data){o.Qty=parseFloat(o.Qty)-parseFloat(e.Qty);o.Amount=parseFloat(o.Qty)*parseFloat(o.PriceUnit);var i=0;$.each(o.ModelBoq,function(t,i){if(e.Buildingno===i.Buildingno&&e.Model===i.Model&&e.SubModel===i.SubModel&&i.delind!=="X"){o.ModelBoq[t].delind="X"}});$.each(o.ModelBoq,function(e,t){if(t.delind!=="X"){i++}});if(i===0&&o.Qty===0){o.condelete="DD"}}});this.getView().getModel("localJson").setProperty("/BoqConsulidatedItemSet",JSON.parse(JSON.stringify(o.sort((e,t)=>e.Data-t.Data))));this.ContractValueHeader()},deleteBOQliseConsolidate:function(e){var t=JSON.parse(JSON.stringify(this.getView().getModel("localJson").getProperty("/BoqItemSet")));var o=this.getView().getModel("localJson").getProperty("/myBuildingSet");var i=this.getView().getModel("localJson").getProperty("/myWBSSet");var a=false;var r=[];var l="";var s="",n="";$.each(o,function(e,t){r.push(t)});$.each(i,function(e,t){r.push(t)});$.each(r,function(t,o){if(o.Group===e.Group&&e.Model===o.Model&&o.DelInd!=="Y"){a=true}});$.each(t,function(t,o){$.each(o.Categories,function(i,r){var d=0;var u=false;if(!a&&o.AddNew==="AN"&&r.Data===e.Group&&r.Model===(e.Model.length===8?e.Model:"00000"+e.Model)&&r.Data===e.Group){n=i;s=t}if(!a&&r.DelInd!=="Y"){d=d+1;if(d===1){u=false}if(d===2){u=true}}if(!a&&o.Categories.length===1&&r.DelInd==="Y"&&o.AddNew==="AN"){l=t}})});if(s!==""&&n!==""){t[s].Categories.splice(n,1)}if(l!==""){t.splice(l,1)}this.getView().getModel("localJson").setProperty("/BoqItemSet",JSON.parse(JSON.stringify(t)))},BoqItemSetCalculate:function(){var e=this,t="0.00",o="0.00",i="0.00";var a=this.getView().getModel("localJson");var r=JSON.parse(JSON.stringify(e.getModel("localJson").getProperty("/BoqItemSet")));var l=this.getView().getModel("localJson").getProperty("/myBuildingSet");var s=this.getView().getModel("localJson").getProperty("/myWBSSet");var n=[];$.each(l,function(e,t){n.push(t)});$.each(s,function(e,t){n.push(t)});var d=e.getModel("localJson").getProperty("/HeadToHeadVariation");var u=JSON.parse(JSON.stringify(e.getModel("localJson").getProperty("/BoqConsulidatedItemSet")));$.each(u,function(e,t){$.each(r,function(e,t){$.each(t.Categories,function(t,o){$.each(o.Categories,function(o,i){$.each(i.Categories,function(i,a){r[e].PriceUnit="0";r[e].Categories[t].PriceUnit="0";r[e].Categories[t].Categories[o].PriceUnit="0"})})})})});$.each(u,function(e,t){$.each(r,function(e,o){$.each(o.Categories,function(o,i){$.each(i.Categories,function(i,a){$.each(a.Categories,function(a,l){if(t.Data===l.Data&&t.Txt===l.Txt&&l.DelInd!=="Y"){r[e].Categories[o].Categories[i].Categories[a].PriceUnit=parseFloat(t.PriceUnit)*parseFloat(r[e].Categories[o].Categories[i].Categories[a].Qty);if(l.Eancat!=="C"&&l.Eancat!=="U"){r[e].PriceUnit=(parseFloat(r[e].PriceUnit)+parseFloat(t.PriceUnit)*parseFloat(r[e].Categories[o].Categories[i].Categories[a].Qty)).toString()}if(l.Eancat!=="C"&&l.Eancat!=="U"){r[e].Categories[o].PriceUnit=(parseFloat(r[e].Categories[o].PriceUnit)+parseFloat(t.PriceUnit)*parseFloat(r[e].Categories[o].Categories[i].Categories[a].Qty)).toString()}if(l.Eancat!=="C"&&l.Eancat!=="U"){r[e].Categories[o].Categories[i].PriceUnit=(parseFloat(r[e].Categories[o].Categories[i].PriceUnit)+parseFloat(t.PriceUnit)*parseFloat(r[e].Categories[o].Categories[i].Categories[a].Qty)).toString()}}})})})})});$.each(e.myWBSSet,function(t,o){$.each(n,function(i,a){if(a.BuildingNo===""){if(o.Model===a.Model){e.myBuildingSet[t].ChangeIndicator=a.ChangeIndicator}}})});$.each(u,function(e,t){t.Amount=parseFloat(t.PriceUnit)*parseFloat(t.Qty)});$.each(u,function(e,o){t=parseFloat(t)+1});$.each(l,function(e,t){if(t.DelInd!="Y"){i=parseFloat(i)+1}});$.each(s,function(e,t){if(t.DelInd!="Y"){o=parseFloat(o)+1}});a.setProperty("/BuildingNO",i);a.setProperty("/WbslistNo",o);a.setProperty("/ServicNOCount",t);e.getView().getModel("localJson").setProperty("/BoqItemSet",JSON.parse(JSON.stringify(r)))},deletesrvA:function(e){var t=this;var o=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/myBuildingSet")));var i=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/BoqItemSet")));var a=JSON.parse(JSON.stringify(t.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet")));$.each(a,function(t,a){$.each(i,function(t,r){$.each(r.Categories,function(r,l){$.each(l.Categories,function(l,s){$.each(s.Categories,function(s,n){if(a.Serviceno===n.Serviceno&&a.Txt===n.Txt&&n.SrvStatus==="A"){var d=false;$.each(o,function(t,o){if((o.Model.length===8?o.Model:"00000"+o.Model)===n.Boq&&n.Boq===e.Boq){d=true;if(o.SrvStatus==="A"){o.SrvStatus="UD"}}});if(d){if(i[t].Categories[r].Categories[l].Categories[s].SrvStatus==="A"){i[t].Categories[r].Categories[l].Categories[s].ChangeIndicator="ChangeP";i[t].Categories[r].Categories[l].Categories[s].SrvStatus="UD"}}}})})})})});t.getView().getModel("localJson").setProperty("/BoqItemSet",JSON.parse(JSON.stringify(i)));t.getView().getModel("localJson").setProperty("/myBuildingSet",JSON.parse(JSON.stringify(o)));t.getModel("localJson").refresh(true)},Consoliatedservicesall:function(){var e=this;var t=this.getView().getModel("localJson").getProperty("/myBuildingSet"),o=this.getModel("localJson");var i=this.getView().getModel("localJson").getProperty("/myWBSSet");var a=[];$.each(t,function(e,t){a.push(t)});$.each(i,function(e,t){a.push(t)});var r=JSON.parse(JSON.stringify(e.getView().getModel("localJson").getProperty("/BoqItemSet")));var l=JSON.parse(JSON.stringify(e.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet")));var s=[];$.each(r,function(e,t){$.each(t.Categories,function(e,t){$.each(t.Categories,function(e,o){$.each(o.Categories,function(e,o){$.each(a,function(e,i){if((i.Model.length===8?i.Model:"00000"+i.Model)===o.Model&&i.Group===t.Data){o.ContractualIndicator=i.ContractualIndicator;o.Txt=i.Txt;o.MatlGroup=o.Item;o.Buildingno=i.BuildingNo;o.PriceUnit=o.Price;o.Amount=parseFloat(o.Price)*parseFloat(o.Qty);if(o.ContractualIndicator==="O"){o.sortNum=1}if(o.ContractualIndicator==="V"){o.sortNum=2}if(o.ContractualIndicator==="A"){o.sortNum=3}s.push(JSON.parse(JSON.stringify(o)))}})})})})});if(e.ViewCon==="V"){e.filterConsoliatedservices(s)}if(e.ViewCon!="V"){if(e.ViewCon==="V2"){e.groupConsolidscreen2(JSON.parse(JSON.stringify(s)))}if(e.ViewCon==="V3"){e.groupConsolidscreen3(JSON.parse(JSON.stringify(s)))}}o.refresh()},filterConsoliatedservices:function(e){var t=this,o=this.byId("idFContractualIndicator").getSelectedKeys(),i=this.getModel("localJso"),a=i.getProperty("/Buildingss"),r=[],l=[],s=[],n=[],d="00000"+t.ModelCodeFilter;if(!this.getModel("localJso").getProperty("/ViewCon3")||!this.getModel("localJso").getProperty("/ViewCon2")){if(o.length>0){o.map(function(t){$.each(e,function(e,o){if(t===o.ContractualIndicator){n.push(JSON.parse(JSON.stringify(o)))}})})}else{$.each(e,function(e,t){n.push(JSON.parse(JSON.stringify(t)))})}if(d!=="00000"){$.each(n,function(e,t){if(d===t.Model){l.push(JSON.parse(JSON.stringify(t)))}})}else{$.each(n,function(e,t){l.push(JSON.parse(JSON.stringify(t)))})}if(a.length>0){a.map(function(e){$.each(l,function(t,o){if(e.BuildingNo===o.Buildingno){r.push(JSON.parse(JSON.stringify(o)))}})})}else{$.each(l,function(e,t){r.push(JSON.parse(JSON.stringify(t)))})}}if(!this.getModel("localJso").getProperty("/ViewCon3")){t.groupConsolidscreen3(JSON.parse(JSON.stringify(r)))}else{t.groupConsolidscreen2(r)}},Consoliatedservices:function(){var e=this;var t=this.getView().getModel("localJson").getProperty("/myBuildingSet");var o=this.getView().getModel("localJson").getProperty("/myWBSSet");var i=[];$.each(t,function(e,t){i.push(t)});$.each(o,function(e,t){i.push(t)});var a=JSON.parse(JSON.stringify(e.getView().getModel("localJson").getProperty("/BoqItemSet")));var r=JSON.parse(JSON.stringify(e.getView().getModel("localJson").getProperty("/BoqConsulidatedItemSet")));var l=JSON.parse(JSON.stringify(e.getView().getModel("localJson").getProperty("/AsbuildService")));var s=[];$.each(a,function(e,t){$.each(t.Categories,function(e,t){$.each(t.Categories,function(e,o){$.each(o.Categories,function(e,o){$.each(i,function(e,i){if((i.Model.length===8?i.Model:"00000"+i.Model)===o.Model&&i.Group===t.Data&&i.AsBuild2===""){o.ContractualIndicator=i.ContractualIndicator;o.Txt=i.Txt;o.DelInd=i.DelInd;o.SrvStatus=i.SrvStatus;o.BuildingNo=i.BuildingNo;if(o.ContractualIndicator==="O"){o.sortNum=1}if(o.ContractualIndicator==="V"){o.sortNum=2}if(o.ContractualIndicator==="A"){o.sortNum=3}s.push(JSON.parse(JSON.stringify(o)))}})})})})});$.each(l,function(e,t){t.Uom=t.BaseUom;t.BuildingNo=t.Buildingno;t.Price=t.PriceUnit;t.LongDesc=t.SrvLongText;t.Eancat=t.ServiceType;t.Data=t.Serviceno;t.SubModel=t.SubBoq;s.push(JSON.parse(JSON.stringify(t)))});$.each(s,function(t,o){o.PriceUnit=o.Price;o.Amount=(parseFloat(o.Price)*parseFloat(o.Qty)).toFixed(e.CustomCurrency)});e.Consoliatedserviceslist(s.sort());e.getView().getModel("localJson").setProperty("/BuildingConsulidatedItemSetfilter",JSON.parse(JSON.stringify(s.sort((e,t)=>e.Data-t.Data))));e.getView().getModel("localJson").setProperty("/BuildingConsulidatedItemSet",JSON.parse(JSON.stringify(s.sort((e,t)=>e.Data-t.Data))))},Consoliatedserviceslist:function(e){var t=this;var o={},i=JSON.parse(JSON.stringify(e)),a=[],r=this.getModel("localJson"),l="0.00",s=false;e.map(function(e){s=false;o.ContractualIndicator=e.ContractualIndicator;o.Model=e.Model;o.Data=e.Data;o.AsBuild2=e.AsBuild2;o.AsBuild=e.AsBuild;o.Servicedesc=e.Servicedesc;o.Uom=e.Uom;o.SrvStatus=e.SrvStatus;o.Qty=0;o.sortNum=e.sortNum;o.Eancat=e.Eancat;o.PriceUnit=e.Price;o.LongDesc=e.LongDesc;o.Txt=e.Txt;o.SubModel=e.SubModel;o.ContractualIndicatorr=e.ContractualIndicator+"R";o.Datar=e.Data+"R";o.Txtr=e.Txt+"R";o.ShortDesc=e.ShortDesc;o.Amount=0;o.BuildingNo=e.BuildingNo;o.Buildings=[];o.ModelBoq=[];i.map(function(e){if(e.Data===o.Data&&e.DelInd!=="Y"&&e.Txt===o.Txt){s=true;var t=false;o.Amount+=parseFloat(e.Amount);o.Qty+=parseFloat(e.Qty);e.Data=o.Datar;e.Txt=o.Txtr;o.Buildings.map(function(o){if(o===e.Buildingno){t=true}});if(!t){var i={Model:e.Model,SubModel:e.SubModel,Buildingno:e.Buildingno===""?e.BuildingNo:e.BuildingNo};o.ModelBoq.push(i)}}});if(s){a.push(JSON.parse(JSON.stringify(o)));i=i.filter(function(e){return e.Data!==o.Datar&&e.Txt!==o.Txtr})}for(var t in o){delete o[t]}});$.each(a,function(e,t){l=parseFloat(l)+1});r.setProperty("/BoqConsulidatedItemSet",JSON.parse(JSON.stringify(a.sort((e,t)=>e.Data-t.Data))));r.setProperty("/ServicNOCount",l)},Consoliatedserviceslistobject:function(e){var t=this;var o={},i=JSON.parse(JSON.stringify(e)),a=[],r=this.getModel("localJson"),l=false;e.map(function(e){l=false;o.Acctasscat=e.Acctasscat;o.Amount=0;o.AsBuild=e.AsBuild;o.AsBuild2=e.AsBuild2;o.sortNum=e.sortNum;o.AsBuilt=e.AsBuilt;o.Uom=e.BaseUom;o.Boq=e.Boq;o.Buildingno=e.Buildingno;o.ContractualIndicator=e.ContractualIndicator;o.DeliveryDate=e.DeliveryDate;o.ItemCat=e.ItemCat;o.Matdesc=e.Matdesc;o.MatlGroup=e.MatlGroup;o.NoLimit=e.NoLimit;o.OvfTol=e.OvfTol;o.Plant=e.Plant;o.PoHeader=e.PoHeader;o.PoItem=e.PoItem;o.PriceUnit=e.PriceUnit;o.Project=e.Project;o.Qty=0;o.LongDesc=e.SrvLongText;o.sorttype=e.sorttype;o.Eancat=e.ServiceType;o.Servicedesc=e.Servicedesc;o.Data=e.Serviceno;o.ShortDesc=e.ShortText;o.SrvNo=e.SrvNo;o.SrvStatus=e.SrvStatus;o.SubBoq=e.SubBoq;o.Txt=e.Txt;o.VariationOrder=e.VariationOrder;o.ContractualIndicatorr=e.ContractualIndicator+"R";o.Datar=e.Serviceno+"R";o.Txtr=e.Txt+"R";o.SubBoqr=e.SubBoq+"R";o.ProvisionRate=e.ProvisionRate;o.Buildings=[];o.ModelBoq=[];i.map(function(e){if(e.Serviceno===o.Data&&e.Txt===o.Txt){l=true;var t=false;o.Qty+=parseFloat(e.Qty);e.ContractualIndicator=o.ContractualIndicatorr;e.Serviceno=o.Datar;e.Txt=o.Txtr;o.Buildings.map(function(o){if(o===e.Buildingno){t=true}});if(!t){var i={Model:e.Boq,SubModel:e.SubBoq,Buildingno:e.Buildingno===""?e.Boq:e.Buildingno};o.ModelBoq.push(i)}}});if(l){a.push(JSON.parse(JSON.stringify(o)));i=i.filter(function(e){return e.Serviceno!==o.Datar&&e.Txt!==o.Txtr})}for(var t in o){delete o[t]}});$.each(a,function(e,t){a[e].Amount=parseFloat(t.Qty)*parseFloat(t.PriceUnit)});return a},ConsoliatedserviceslistCreate:function(e){var t=this;var o={},i=JSON.parse(JSON.stringify(e)),a=[],r=this.getModel("localJson"),l=false;e.map(function(e){l=false;o.ContractualIndicator=e.ContractualIndicator;o.sortNum=e.sortNum;o.Model=e.Model;o.Data=e.Data;o.ShortDesc=e.ShortDesc;o.Uom=e.Uom;o.Qty=0;o.Eancat=e.Eancat;o.Item=e.Item;o.ModelType=e.ModelType;o.PriceUnit=e.PriceUnit;o.Datar=e.Data+"R";o.MatlGroup=e.MatlGroup;o.Txt=e.Txt;o.Amount=0;o.BuildingNo=e.BuildingNo;o.Buildings=[];o.ModelBoq=[];i.map(function(e){if(e.Data===o.Data){l=true;var t=false;o.Qty+=parseFloat(e.Qty);e.Data=o.Datar;o.Buildings.map(function(t){if(t===e.Buildingno){modelExists=true}});if(!modelExists){var i={Model:e.Model,SubModel:e.SubModel,Buildingno:e.Buildingno===""?e.Model:e.BuildingNo};o.ModelBoq.push(i)}}});if(l){a.push(JSON.parse(JSON.stringify(o)));i=i.filter(function(e){return e.Data!==o.Datar})}for(var t in o){delete o[t]}});$.each(a,function(e,t){a[e].Amount=parseFloat(t.Qty)*parseFloat(t.PriceUnit)});return a},treeHandel:function(e,t){var o=this;var i={},a=JSON.parse(JSON.stringify(e)),r=[],l=this.getModel("localJson"),s=false;t.map(function(e){s=false;i.ContractualIndicator=e.ContractualIndicator;i.sortNum=e.sortNum;i.Categories=e.Categories;i.Data=e.Data;i.Eancat=e.Eancat;i.Item=e.Item;i.LevelId=e.LevelId;i.LevelNo=e.LevelNo;i.LongDesc=e.LongDesc;i.Model=e.Model;i.Node=e.Node;i.Parent=e.Parent;i.Qty=e.Qty;i.ShortDesc=e.ShortDesc;i.SubModel=e.SubModel;i.Uom=e.Uom;i.LevelIdd=e.LevelId+"R";i.Modell=e.Model+"R";a.map(function(e){if(e.LevelId===i.LevelId&&e.Model===i.Model){s=true;e.ContractualIndicator=i.Modell;e.LevelId=i.LevelIdd}});if(s){r.push(JSON.parse(JSON.stringify(i)));a=a.filter(function(e){return e.LevelId!==i.LevelIdd&&e.Model!==i.Modell})}for(var t in i){delete i[t]}});return r},handleAddAttachmentPress:function(e){var t=this;if(t._addAttachmentDialog){t._addAttachmentDialog.destroy();t._addAttachmentDialog=null}if(!t._addAttachmentDialog){t._addAttachmentDialog=sap.ui.xmlfragment(t.getView().getId(),"com.cicre.po.view.fragments.Attachment",t);t.getView().addDependent(t._addAttachmentDialog)}t._addAttachmentDialog.open()},onAddAttachment:function(e){var t=this;var o={};var i=t.getModel("localJson").getProperty("/AttachmentSet");if(t.byId("idRequestAttachment").data("details")){o=$.extend(o,JSON.parse(t.byId("idRequestAttachment").data("details")))}i.push(o);t.getModel("localJson").setProperty("/AttachmentSet",i);t._addAttachmentDialog.close()},onCancelAttachment:function(e){this._addAttachmentDialog.close()},handleUploadPress:function(e){var t=["pdf","jpg","jpeg","png","txt","xls","xlsx","xlsm","xltx","xltm","doc","docx"];var o=this;var i=e.getParameters().id;var a=sap.ui.getCore().byId(i);a.data("details","");var r=a.getValue().lastIndexOf(".");var l=a.getValue().substring(0,r);if(!a.getValue()){o.handleErrorMessageBox(o.getResourceBundle().getText("baseMSGNoAttachment"));return}var s=jQuery.sap.domById(a.getId()+"-fu").files[0];var n=s.type;var d=s.name.substring(r+1,s.name.length);d=d.toLowerCase();if($.inArray(d,t)>-1){var u="data:"+s.type+";base64,";var g=new FileReader;g.onload=function(e){return function(e){var t=e.target.result.indexOf(u)+u.length;var o=e.target.result.substring(t);var i={Value:o,Extension:d,Filename:l,Flag:"A"};a.data("details",JSON.stringify(i))}}(s);g.readAsDataURL(s)}else{a.data("details",null);a.setValue("");o.handleErrorMessageBox(o.getResourceBundle().getText("baseMSGMismatchAttachmentType",[t.join(", ")]))}},onAttachmentDelete:function(e){var t=this;var o=e.getParameter("listItem").getBindingContext("localJson").getPath();i.confirm(t.getResourceBundle().getText("baseMSGConfirmDelete"),{title:t.getResourceBundle().getText("Confirm"),onClose:function(e){if(e==sap.m.MessageBox.Action.OK){var i=o.substring(0,o.lastIndexOf("/"));var a=parseInt(o.substring(o.lastIndexOf("/")+1,o.length));var r=t.getModel("localJson").getProperty(i);if(r[a].DocNo){r[a].Flag="D"}else{r.splice(a,1)}t.getModel("localJson").setProperty(i,r)}}})},_onAttachmentItemPress:function(e){if(e.getSource().getBindingContext("localJson").getObject().DocNo){var t=e.getSource().getBindingContext("localJson").getObject();var o=this.getOwnerComponent().getModel().sServiceUrl+"/AttachmentReadSet(DocNo='"+t.DocNo+"',AttachmentId='"+t.AttachmentId+"')/$value";window.open(o,"_blank")}},onSearchWBSDialog:function(){if(!this._WBSDialog){this._WBSDialog=sap.ui.xmlfragment("com.cicre.po.view.fragments.WBSSearchDialog",this);this._WBSDialog.setModel(this.getView().getModel())}this._WBSDialog.open();var e=new sap.m.StandardListItem({title:"{IdText}",description:"{SelectionParameter}"});var t=[];var o=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"WBSSEARCH");var i=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,this.sCoCode);var a=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var r=new sap.ui.model.Filter("SelectionParameter7",sap.ui.model.FilterOperator.Contains,this.WBSCodeGroup);t.push(o);t.push(i);t.push(a);if(this.WBSCodeGroup.length>0){t.push(r)}this._WBSDialog.bindAggregation("items",{path:"/ValueHelpSet",template:e,filters:t})},handleSearchWBS:function(e){var t=new sap.m.StandardListItem({title:"{IdText}",description:"{SelectionParameter}"});var o=e.getParameter("value");var i=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"WBSSEARCH");var a=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,this.sCoCode);var r=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var l=new sap.ui.model.Filter("SelectionParameter4",sap.ui.model.FilterOperator.Contains,o);var s=new sap.ui.model.Filter("SelectionParameter7",sap.ui.model.FilterOperator.Contains,this.WBSCodeGroup);var n=[];n.push(i);n.push(a);n.push(r);n.push(l);if(this.WBSCodeGroup.length>0){n.push(s)}this._WBSDialog.bindAggregation("items",{path:"/ValueHelpSet",template:t,filters:n})},onSelectWBSList:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){t.WBSCode=e.getObject().IdNumber;t.getView().byId("idSearchWBSDialog").setValue(e.getObject().IdText)})}else{t.WBSCode="";t.getView().byId("idSearchWBSDialog").setValue("");sap.m.MessageToast.show("No new item was selected.")}e.getSource().getBinding("items").filter([])},onDisplaySearchWBSGroup:function(){if(!this._WBSGroupDialog){this._WBSGroupDialog=sap.ui.xmlfragment("com.cicre.po.view.fragments.WBSGroupSearchDialog",this);this._WBSGroupDialog.setModel(this.getView().getModel())}this._WBSGroupDialog.open();var e=new sap.m.StandardListItem({title:"{SelectionParameter7}",description:"{IdNumber}"});var t=[];var o=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"WBSGROUP");var i=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,this.sCoCode);var a=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.EQ,this.sProjectCode);t.push(o);t.push(i);t.push(a);this._WBSGroupDialog.bindAggregation("items",{path:"/ValueHelpSet",template:e,filters:t})},handleSearchWBSGroup:function(e){var t=new sap.m.StandardListItem({title:"{SelectionParameter7}",description:"{IdNumber}"});var o=e.getParameter("value");var i=new sap.ui.model.Filter("ValueHelpType",sap.ui.model.FilterOperator.EQ,"WBSGROUP");var a=new sap.ui.model.Filter("SelectionParameter2",sap.ui.model.FilterOperator.EQ,this.sCoCode);var r=new sap.ui.model.Filter("SelectionParameter3",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var l=new sap.ui.model.Filter("SelectionParameter7",sap.ui.model.FilterOperator.Contains,o);var s=[];s.push(i);s.push(a);s.push(r);s.push(l);this._WBSGroupDialog.bindAggregation("items",{path:"/ValueHelpSet",template:t,filters:s})},onSelectWBSGroupList:function(e){var t=this;var o=e.getParameter("selectedContexts");if(o&&o.length){o.map(function(e){t.getView().getModel("localJson").setProperty("/selectGroupBoq",false);t.WBSCodeGroup=e.getObject().IdNumber;t.getView().byId("idSearchWBSGroupDialog").setValue(e.getObject().SelectionParameter7)})}else{t.WBSCodeGroup="";t.getView().byId("idSearchWBSGroupDialog").setValue("");sap.m.MessageToast.show("No new item was selected.")}e.getSource().getBinding("items").filter([])},cleanWBSDialog:function(){this.WBSCode="";this.getView().byId("idSearchWBSDialog").setValue("")},cleanSearGroupWBS:function(){this.WBSCodeGroup="";this.getView().getModel("localJson").setProperty("/selectGroupBoq",false);this.getView().byId("idSearchWBSGroupDialog").setValue("");this.cleanGroupBoqDialog()},onSearchGroupBoqDialog:function(e){if(!this._GroupBoqDialog){this._GroupBoqDialog=sap.ui.xmlfragment("com.cicre.po.view.fragments.GroupBoqSearchDialog",this);this._GroupBoqDialog.setModel(this.getView().getModel())}this._GroupBoqDialog.open();this.sSubBoq2Id=e.getParameters().id;var t=new sap.ui.model.Filter("Boq",sap.ui.model.FilterOperator.EQ,this.WBSCodeGroup);var o=new sap.ui.model.Filter("CompCode",sap.ui.model.FilterOperator.EQ,this.sCoCode);var i=new sap.ui.model.Filter("Project",sap.ui.model.FilterOperator.EQ,this.sProjectCode);var a=new sap.m.StandardListItem({title:"{BoqSub}",description:"{BoqDesc}"});var r=[];r.push(t);r.push(o);r.push(i);this._GroupBoqDialog.bindAggregation("items",{path:"/BoqSubItemSet",template:a,filters:r})},handleSearchSubGroupBoq:function(e){var t=new sap.m.StandardListItem({title:"{BoqSub}",description:"{BoqDesc}"});var o=e.getParameter("value");var i=new sap.ui.model.Filter("Boq",sap.ui.model.FilterOperator.EQ,this.WBSCodeGroup);var a=[];a.push(i);this._GroupBoqDialog.bindAggregation("items",{path:"/BoqSubItemSet",template:t,filters:a})},onSelectSubGroupBoqList:function(e){var t=this;var o=e.getParameter("selectedContexts");var i=this.getView().getModel("localJson").getProperty("/WBSSet");if(o&&o.length){o.map(function(e){t.sSubBoq=e.getObject().BoqSub;t.getView().byId("idSearchGroupBoqDialog").setValue(e.getObject().BoqDesc);$.each(i,function(t,o){i[t].Group=e.getObject().BoqSub;i[t].BoqDesc=e.getObject().BoqDesc});t.getView().getModel("localJson").setProperty("/WBSSet",i)})}else{sap.m.MessageToast.show("No new item was selected.");t.getView().byId("idSearchGroupBoqDialog").setValue("")}},cleanGroupBoqDialog:function(){var e=this.getView().getModel("localJson").getProperty("/WBSSet");$.each(e,function(t,o){e[t].Group="";e[t].BoqDesc=""});this.getView().getModel("localJson").setProperty("/WBSSet",e);this.getView().getModel("localJson").setProperty("/selectGroupBoq",false);this.getView().byId("idSearchGroupBoqDialog").setValue("")}})});
//# sourceMappingURL=BaseController.js.map